@if (options.type == 'title') {
  <div>
    <h1 class="form-title">{{ options.label }}</h1>
  </div>
} @else {
<div class="form-group">
  @if (options.label) {
    <div class="input-group">
      <label class="input-label">
        {{ options.label}}
        @if (options.required) {
          <span class="text-danger">*</span>
        }
      </label>
      @if (options.tooltip) {
        <button [title]="options.tooltip">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
            <path stroke-linecap="round" stroke-linejoin="round" d="M9.879 7.519c1.171-1.025 3.071-1.025 4.242 0 1.172 1.025 1.172 2.687 0 3.712-.203.179-.43.326-.67.442-.745.361-1.45.999-1.45 1.827v.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Zm-9 5.25h.008v.008H12v-.008Z" />
          </svg>
        </button>
      }
    </div>
  }
  <div [ngStyle]="{ position: 'relative' }">
    @switch (options.type) {
      @case('date') {
        <!-- Date Picker Input -->
        <div>
          <input
            [owlDateTime]="dt1"
            [value]="options.defaultValue || ''"
            [owlDateTimeTrigger]="dt1"
            [ngClass]="isError ? 'input-error' : 'input-default'"
            [class]="options.className || ''"
            (dateTimeChange)="_onDateTimeChange($event)"
            [placeholder]="options.placeholder || ''"
          />
          <owl-date-time #dt1 pickerType="calendar"></owl-date-time>
        </div>
        <!-- End of date picker Input -->
      }

      @case('time') {
        <!-- Time picker Input -->
        <div>
          <input
            [owlDateTime]="dt2"
            [value]="options.defaultValue || ''"
            [owlDateTimeTrigger]="dt2"
            [ngClass]="isError ? 'input-error' : 'input-default'"
            [class]="options.className || ''"
            (dateTimeChange)="_onDateTimeChange($event)"
            [placeholder]="options.placeholder || ''"
          />
          <owl-date-time #dt2 pickerType="timer"></owl-date-time>
        </div>
        <!-- End of time picker Input -->
      }

      @case('radio') {
        <!-- Radio Button-->
        <div class="input-radio-wrapper">
          @for (option of options.options; let i = $index; track option) {
          <div>
            <input
              type="radio"
              [checked]="options.defaultValue === option.value"
              [value]="option.value"
              [name]="options.name"
              [id]="options.name + '-' + i"
              (change)="_onChange($event)"
            />
            <div class="input-radio-label">
              <label [for]="options.name + '-' + i" class="label-text">
                {{option.label}}
              </label>
              @if (option.description) {
                <p class="label-description">
                  {{ option.description }}
                </p>
              }
            </div>
          </div>
          }
        </div>
        <!-- End of Radio Button -->
      }

      @case('checkbox') {
        <!-- Checkbox -->
        <div class="input-checkbox-wrapper">
          @for (option of options.options; let i = $index; track option) {
          <div>
            <input
              type="checkbox"
              [checked]="options.defaultValue === option.value"
              [value]="option.value"
              [name]="options.name"
              [id]="options.name + '-' + i"
              (change)="_onCheckboxChange($event)"
            />
            <div class="input-radio-label">
              <label [for]="options.name + '-' + i" class="label-text">
                {{option.label}}
              </label>
              @if (option.description) {
                <p class="label-description">
                  {{ option.description }}
                </p>
              }
            </div>
          </div>
          }
        </div>
        <!-- End of checkbox -->
      }

      @case('textarea') {
        <!-- Textarea -->
        <textarea
          [placeholder]="options.placeholder || ''"
          [ngClass]="isError ? 'input-error' : 'input-default'"
          [class]="options.className"
          [rows]="options.rows || 3"
          (keyup)="_onChange($event)"
          >
          {{ options.defaultValue }}
        </textarea>
        <!-- End of Textarea-->
      }

      @case('select') {
        <!-- Select -->
        <div>
          <ng-select
            [(ngModel)]="selectModel"
            (change)="_onSelectChange($event)"
            [multiple]="options.multiple || false"
          >
            <ng-option
              *ngFor="let option of options.options"
              [value]="option.value"
              >{{ option.label }}</ng-option
            >
          </ng-select>
        </div>
        <!-- End of select -->
      }

      @case('file') {
        <!-- File upload -->
        <div>
          <ngx-dropzone [ngStyle]="{ width: '100%', height: '100%'}">
            <div class="dropzone-container">
              <div class="dropzone-input">
                <input
                  type="file"
                  multiple
                  fileInput
                  [(ngModel)]="file"
                  (ngModelChange)="_onUpload($event)"
                  #inputFile
                />
                <button (click)="inputFile.click()" >
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 0 0 5.25 21h13.5A2.25 2.25 0 0 0 21 18.75V16.5m-13.5-9L12 3m0 0 4.5 4.5M12 3v13.5" />
                  </svg>
                </button>
                <div class="description">
                  Drag-drop / Attach files from your computer
                </div>
              </div>
              @if (uploadedFiles.length > 0) {
              <div class="dropzone-files-container">
                @for (item of uploadedFiles; let i = $index; track item) {
                <div class="dropzone-files">
                  @if (getFileIcon(item.type) === 'image') {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m2.25 15.75 5.159-5.159a2.25 2.25 0 0 1 3.182 0l5.159 5.159m-1.5-1.5 1.409-1.409a2.25 2.25 0 0 1 3.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 0 0 1.5-1.5V6a1.5 1.5 0 0 0-1.5-1.5H3.75A1.5 1.5 0 0 0 2.25 6v12a1.5 1.5 0 0 0 1.5 1.5Zm10.5-11.25h.008v.008h-.008V8.25Zm.375 0a.375.375 0 1 1-.75 0 .375.375 0 0 1 .75 0Z" />
                    </svg>
                  } @else {
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M19.5 14.25v-2.625a3.375 3.375 0 0 0-3.375-3.375h-1.5A1.125 1.125 0 0 1 13.5 7.125v-1.5a3.375 3.375 0 0 0-3.375-3.375H8.25m2.25 0H5.625c-.621 0-1.125.504-1.125 1.125v17.25c0 .621.504 1.125 1.125 1.125h12.75c.621 0 1.125-.504 1.125-1.125V11.25a9 9 0 0 0-9-9Z" />
                    </svg>
                  }
                  <div class="file-info">
                    <div class="title">{{ item.name }}</div>
                    <div class="description">
                      type: {{ item.type }} size: {{ item.size }}
                    </div>
                  </div>
                  <button (click)="_onRemoveFile(i)">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-6 h-6">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M6 18 18 6M6 6l12 12" />
                    </svg>
                  </button>
                </div>
                }
              </div>
              }
            </div>
          </ngx-dropzone>
        </div>
        <!-- End of file upload -->

      }

      @case('search') {
        <!-- Search -->
        <div class="search-container">
          <input
            #searchInput
            [placeholder]="options.placeholder || ''"
            [class]="options.className"
            (keyup)="_onSearch($event)"
          />
          <div class="search-popup" [hidden]="!searchFocused">
            <div
              class="bg-slate-100 rounded-t text-gray-600 text-sm font-bold px-4 py-3 border-b border-slate-200">
              Search Results:
            </div>
            <div class="max-h-80 overflow-x-hidden">
              @if (searchResults.length === 0) {
                <div class="w-full text-center py-8 text-gray-500 text-sm">
                  No record found!
                </div>
              }
              <div class="divide-y divide-slate-100">
                @for (result of searchResults; let i = $index; track result) {
                  <a
                    (click)="_onSelectSearchResult(result); searchFocused = false"
                    (keyup)="_onSelectSearchResult(result); searchFocused = false"
                    tabindex="0"
                    class="flex flex-row gap-3 items-center py-2 px-4 cursor-pointer hover:bg-slate-50"
                  >
                    <i class="icon text-gray-600 text-xl">{{
                      options.api?.leadingIcon || "note"
                    }}</i>
                    <div class="flex-1 flex flex-col w-full overflow-hidden">
                      <div
                        class="text-sm font-medium truncate"
                        title="{{ result.label }}"
                      >
                        {{ result.label }}
                      </div>
                      <div
                        *ngIf="result.description"
                        class="truncate text-xs text-gray-500"
                        title="{{ result.description }}"
                      >
                        {{ result.description }}
                      </div>
                    </div>
                  </a>
                }
              </div>
            </div>
          </div>
        </div>
        <!-- End of Search -->

      }

      @default {
        <!-- Text Input -->
        <input
          *ngIf="textType.includes(options.type)"
          [value]="options.defaultValue || ''"
          [type]="options.type"
          [placeholder]="options.placeholder || ''"
          [ngClass]="isError ? 'input-error' : 'input-default'"
          [class]="options.className || ''"
          [min]="options.min"
          [max]="options.max"
          (keyup)="_onChange($event)"
        />
        <!-- ENd of Text Input -->
      }
    }

    <i
      *ngIf="options.leadingIcon"
      class="icon text-gray-500 text-lg absolute left-3 top-1/2 transform -translate-y-1/2"
      >{{ options.leadingIcon }}</i
    >
    <i
      *ngIf="options.trailingIcon"
      class="icon text-gray-500 text-lg absolute right-3 top-1/2 transform -translate-y-1/2"
      >{{ options.trailingIcon }}</i
    >
  </div>
  <p *ngIf="options.hint && !isError" class="block text-xs text-gray-500">
    {{ options.hint }}
  </p>
  <p *ngIf="isError" class="block text-xs text-danger">{{ errorText }}</p>
  <!-- Selected search result -->
  <div *ngIf="options.type === 'search'" class="selected-search pt-2 w-full">
    <div class="rounded-lg border">
      <div
        class="border-b px-4 py-2 text-sm font-medium bg-slate-100 rounded-t-lg"
      >
        ({{ selectedSearchResult.length || 0 }}) Selected
      </div>
      <div class="divide-y divide-slate-100">
        <div
          *ngIf="selectedSearchResult.length === 0"
          class="py-4 flex items-center text-gray-400 justify-center"
        >
          <span>No record selected</span>
        </div>
        <div
          *ngFor="let result of selectedSearchResult; let i = index"
          class="flex flex-row gap-3 items-center py-2 px-4"
        >
          <i class="icon text-gray-500 text-xl mt-0.5">{{
            options.api?.leadingIcon || "note"
          }}</i>
          <div class="flex-1 flex flex-col w-full overflow-hidden">
            <div class="text-sm font-medium truncate">{{ result.label }}</div>
            <div
              *ngIf="result.description"
              class="truncate text-xs text-gray-500"
            >
              {{ result.description }}
            </div>
          </div>
          <div
            *ngIf="options.enableRoleInSearchResult"
            class="w-full max-w-[65px]"
          >
            <select
              [(ngModel)]="_data[options.name][i].role"
              (change)="_onRoleChange($event, i)"
              class="border border-slate-200 text-sm rounded-lg py-1.5 focus:ring-primary w-full px-3"
            >
              <option *ngFor="let role of roles" [value]="role.value">
                {{ role.label }}
              </option>
            </select>
          </div>
          <button
            (click)="_onRemoveSearchResult(i)"
            class="text-gray-500 text-xl"
          >
            <i class="icon">close</i>
          </button>
        </div>
      </div>
    </div>
    <!-- End of Selected search results -->
  </div>
</div>
}
